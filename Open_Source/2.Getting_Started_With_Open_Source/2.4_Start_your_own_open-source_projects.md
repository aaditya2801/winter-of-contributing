INTEGRATION OF ANSIBLE AND AWS CLOUD
------------------------------------

<p align = "center">
<img src="https://miro.medium.com/max/690/1*A-D6cuz1WofJOR81z1yWJQ.png"  style="width:1000px; 
            height:400px; 
            display: block;" />
</p>

* [GitHub Profile](https://github.com/aaditya2801)
* [Project Repo](https://github.com/aaditya2801/ansible-eks.git)
* [Ansible Galaxy Link](https://galaxy.ansible.com/aaditya2801/ansible_eks)
* [Blog Link](https://aadityatiwari2801.medium.com/integrating-ansible-with-aws-resources-ced3f93c6f13)


## Role: ansible-eks

I have Integrated DevOps Automation Tool: Ansible with Amazon (AWS) Elastic Kubernetes Service and Deployed Multi-tier Architecture on the top of EKS Cluster. For Solving this use case I have created one Ansible Role which contains variables, files, and tasks.

## Following are the List of AWS Resources that I have deployed using this Role:

* Virtual Private Cloud (VPC): Isolated virtual network.
* Two Public Subnets in Availability Zone (AZ): ap-south-1a and ap-south-1b.
* Internet Gateway: That allows communication between VPC and the Internet.
* Route Table: This contains a set of rules, called routes, that are used to determine where network traffic from your subnet or gateway is directed.
* Security Group: Virtual firewall to control inbound traffic (port: 22, 80, 3306) and outbound traffic (allow all traffic).
* Two Roles: One for EKS that contains “AmazonEKSClusterPolicy” and another one for EC-2 that contains “AmazonEC2FullAccess”, “AmazonEKSWorkerNodePolicy” and “AmazonEC2ContainerRegistryFullAccess/ReadOnly”.
* EKS Cluster: It is a managed Kubernetes service that makes it easy for you to run Kubernetes on AWS and on-premises.
* Node Group for EKS Cluster: It automates the provisioning and lifecycle management of nodes (Amazon EC2 instances) for Amazon EKS Kubernetes clusters.

## List of Modules that I have used in Role: 
pip, Blockinfile, ec2_vpc_net, ec2_vpc_subnet, ec2_vpc_igw, ec2_vpc_route_table, ec2_group, iam_role, aws_eks_cluster, yum_repository, package, command.

## Explanation of Files that I have used in Role:

* policy1.json: It contains assume role policy document for service: eks.amazonaws.com.
* policy2.json: It contains assume role policy document for service: ec2.amazonaws.com.
* sc.yml: It deploy Storage Class with provisioner: Kubernetes.io/aws-ebs, type: gp2, zones: ap-south-1a/1b, iopsPerGB: 10 and fsType: ext4.
* secret.yml: It stores secrets in Base64 including username, password, and database name that requires in a multi-tier architecture.
* wordpress.yml: It creates WordPress deployment, exposes it with service type: load balancer, and claims the storage from the PersistentVolumeClaim (PVC) which is bound with AWS-EBS Storage Class.
* mysql.yml: It creates MySQL deployment, exposes it with service type: ClusterIP, and claims the storage from the PersistentVolumeClaim (PVC) which is bounded with AWS-EBS Storage Class.

## Explanation of Important Variables that I have used in Role:

* policy1: contain ARN for EKS Cluster Policy.
* policy2: contain ARN for EC2 Full Access.
* policy3: contain ARN for EKS Worker Node Policy.
* policy4: contain ARN for EC2 Container Registry Full Access.
* policy5: contain ARN for EC2 Container Registry Read Only.
* b_url: contain Base URL for Kubernetes Repo.
* g_key: contain GPG Key for Kubernetes Repo.

## Technologies Used:
* Configuration Management Tool: Ansible.
* Public Cloud: Amazon Web Services (AWS).
* Operating System: RHEL-8.

## Conclusion: 
In this role, I have covered the deployment of WordPress with MySQL Server on multi-tier architecture. It encourages the best practice of creating application components that are easy to maintain, decouple, and scale.

## Future Scope: 

I can add more AWS resources like KMS for creating and managing cryptographic keys for Security and Encrypting Volume, it can integrate with AWS CloudTrail to provide us with logs of all key usage. Replacing EBS with EFS, so PVC will be bound with AWS-EFS Storage Class are some of my Future Work for this Project.

## playbook for executing role:

```
- hosts: localhost
    vars_prompt:
  - name: "access_key"
    prompt: "Enter access key"
    private: yes
  - name: "secret_key"
    prompt: "Enter secret key"
    private: yes
    roles:
    - role: ansible-eks
```
## Additional Resources:

* Ansible: https://docs.ansible.com/
* AWS VPC: https://docs.aws.amazon.com/vpc/index.html
* AWS EKS: https://aws.amazon.com/eks/
* Kubernetes: https://kubernetes.io/
